const anychatdefine=require('./anychatdefine'),noop=function(){};function EventEmitter(){this.event_k_v={}}EventEmitter.prototype.on=function(a,b){this.event_k_v[a]=this.event_k_v[a]||[],this.event_k_v[a].push(b)},EventEmitter.prototype.emit=function(a){var b=this.event_k_v[a]||[],c=Array.prototype.slice.call(arguments,1);b.map(function(a){a.apply(null,c)})};function AnyChatMiniProgram(){this.ANYCHAT_SDK_VERSION='R.1.1.0 commit f0a099b83f01d4769017e99921ebb709a98f153e',this.wss_url='',this.signaling=null,this.userId='',this.mediaId='',this.userIdList=[],this.userIduserInfoMapping={},this.roomId=0,this.mediaDeviceStatus={},this.wx_pusher=null,this.wx_puller=null,this.pusher_rtmpurl={},this.puller_rtmpurl={},this.reconnect_handle=-1,this.heartbeat_handle=-1,this.seq=1,this.currentDevice='',this.areaIdareaInfoMapping={},this.queueIdqueueInfoMapping={},this.agentIdagentInfoMapping={},this.realtimeAreaStatus={},this.realtimeQueueStatus={},this.realtimeAgentStatus={},this.userIduserInfoMappingBackup={}}AnyChatMiniProgram.prototype=new EventEmitter,AnyChatMiniProgram.prototype.OnAnyChatConnect=noop,AnyChatMiniProgram.prototype.OnAnyChatLoginSystem=noop,AnyChatMiniProgram.prototype.OnAnyChatEnterRoom=noop,AnyChatMiniProgram.prototype.OnAnyChatRoomOnlineUser=noop,AnyChatMiniProgram.prototype.OnAnyChatUserAtRoom=noop,AnyChatMiniProgram.prototype.OnAnyChatLinkClose=noop,AnyChatMiniProgram.prototype.OnAnyChatObjectEvent=noop,AnyChatMiniProgram.prototype.OnAnyChatVideoCallEvent=noop,AnyChatMiniProgram.prototype.OnAnyChatTextMessage=noop,AnyChatMiniProgram.prototype.OnAnyChatTransBuffer=noop,AnyChatMiniProgram.prototype.OnAnyChatTransBufferEx=noop,AnyChatMiniProgram.prototype.OnAnyChatTransFile=noop,AnyChatMiniProgram.prototype.OnAnyChatRecordSnapShot=noop,AnyChatMiniProgram.prototype.OnAnyChatRecordSnapShotEx=noop,AnyChatMiniProgram.prototype.OnAnyChatRecordSnapShotEx2=noop,AnyChatMiniProgram.prototype.OnSignalingError=noop,AnyChatMiniProgram.prototype.BRAC_InitSDK=function(){},AnyChatMiniProgram.prototype.BRAC_GetVersion=function(){return ANYCHAT_SDK_VERSION},AnyChatMiniProgram.prototype.BRAC_RegisterCallBack=function(){},AnyChatMiniProgram.prototype.BRAC_SetVideoPos=function(a,b){let c=this;if(-1==a||a==this.userId){let a=wx.createLivePusherContext(b);this.wx_pusher=a,a.start({success:function(){c.currentDevice='user'}})}else{let a=wx.createLivePlayerContext(b);this.wx_puller=a,a.play()}return 0},AnyChatMiniProgram.prototype.BRAC_SetVideoPosEx=function(a,b){let c=this;if(-1==a||a==this.userId){let a=wx.createLivePusherContext(b);this.wx_pusher=a,a.start({success:function(){c.currentDevice='user'}})}else{let a=wx.createLivePlayerContext(b);this.wx_puller=a,a.play()}return 0},AnyChatMiniProgram.prototype.BRAC_Connect=function(a,b){if(!a||65536<b||0>b)return 21;let c='wss://'+a;return b&&(c+=':'+b),this.emit('websocket_connect',c),0},AnyChatMiniProgram.prototype.BRAC_Login=function(a,b,c){if(!a)return 210;b=b?b:'',c=c?c:0;let d={cmdcode:'login',username:a,password:b,passenctype:c};return this.emit('websocket_send',d),0},AnyChatMiniProgram.prototype.BRAC_LoginEx=function(a,b,c,d,e,f,g){if(!a)return 210;b=b?b:-1,c=c?c:a,d=d?d:'',e=e?e:0,f=f?f:'',g=g?g:'';let h={cmdcode:'loginex',nickname:a,userid:b,struserid:c,appid:d,timestamp:e,lpSigStr:f,lpStrParam:g,platformtype:1};return this.emit('websocket_send',h),0},AnyChatMiniProgram.prototype.BRAC_EnterRoom=function(a,b,c){if(!this.userId)return 307;if(a=+a,b=b?b:'',c=c?c:0,!a)return-1;let d={cmdcode:'enterroom',roomid:a,roompass:b,passenctype:c};return this.emit('websocket_send',d),0},AnyChatMiniProgram.prototype.BRAC_EnterRoomEx=function(a,b){if(!this.userId)return 307;a=a?a+'':'',b=b?b+'':'';let c={cmdcode:'enterroomex',roomname:a,roompass:b};return this.emit('websocket_send',c),0},AnyChatMiniProgram.prototype.BRAC_LeaveRoom=function(){if(!this.roomId)return 308;let a={cmdcode:'leaveroom',roomid:this.roomId},b={cmdcode:'mediacontrol',mediaid:this.mediaId,mediatype:1,controltype:0,jsonbuf:''};for(let a in this.emit('websocket_send',b),this.userIduserInfoMapping)-1!=a.userId&&a.userId!=this.userId&&(b.mediaid=a.mediaId,b.mediatype=2,this.emit('websocket_send',b));return this.emit('websocket_send',a),this.wx_pusher&&this.wx_pusher.stop(),this.wx_puller&&this.wx_puller.stop(),0},AnyChatMiniProgram.prototype.BRAC_Logout=function(){return this.emit('websocket_send',{cmdcode:'logout'}),0},AnyChatMiniProgram.prototype.BRAC_Release=function(){return this.BRAC_Logout(),this.wx_pusher&&this.wx_pusher.stop(),this.wx_puller&&this.wx_puller.stop(),this.wx_pusher=this.wx_puller=null,0},AnyChatMiniProgram.prototype.BRAC_GetOnlineUser=function(){return this.userIdList},AnyChatMiniProgram.prototype.BRAC_GetRoomOnlineUsers=function(a){return-1==a||a==this.roomId?this.userIdList:[]},AnyChatMiniProgram.prototype.BRAC_EnumDevices=function(){return['user','environment']},AnyChatMiniProgram.prototype.BRAC_SelectVideoCapture=function(a,b){let c=this;if('environment'==this.currentDevice&&'user'==b)this.wx_pusher.switchCamera({success:function(){c.currentDevice='user'}});else if('user'==this.currentDevice&&'environment'==b)this.wx_pusher.switchCamera({success:function(){c.currentDevice='environment'}});else return-1},AnyChatMiniProgram.prototype.BRAC_GetCurrentDevice=function(){return this.currentDevice},AnyChatMiniProgram.prototype.BRAC_UserCameraControl=function(a,b){this.userId==a&&(a=-1);let c,d;if(-1==a)c=this.mediaId,d=1;else{d=2;let b=this.userIduserInfoMapping[a]||this.userIduserInfoMappingBackup[a]||{};c=b.mediaId||''}let e={cmdcode:'mediacontrol',mediaid:c,mediatype:d,controltype:b,jsonbuf:''};1==b?!this.mediaDeviceStatus[a]&&(this.mediaDeviceStatus[a]=1,this.emit('websocket_send',e)):0==b&&this.mediaDeviceStatus[a]&&(this.emit('websocket_send',e),this.mediaDeviceStatus[a]=0);let f={cmdcode:'usercameracontrol',mediaid:c,userid:a,open:b};return this.emit('websocket_send',f),0},AnyChatMiniProgram.prototype.BRAC_UserCameraControlEx=function(a,b,c,d,e){this.userId==a&&(a=-1);let f,g;if(-1==a)f=this.mediaId,g=1;else{g=2;let b=this.userIduserInfoMapping[a]||this.userIduserInfoMappingBackup[a]||{};f=b.mediaId||''}let h={cmdcode:'mediacontrol',mediaid:f,mediatype:g,controltype:b,jsonbuf:''};1==b?!this.mediaDeviceStatus[a]&&(this.mediaDeviceStatus[a]=1,this.emit('websocket_send',h)):0==b&&this.mediaDeviceStatus[a]&&(this.emit('websocket_send',h),this.mediaDeviceStatus[a]=0);let i={cmdcode:'usercameracontrolex',mediaid:f,userid:a,open:b,streamindex:c,flags:d,strparam:e};return this.emit('websocket_send',i),0},AnyChatMiniProgram.prototype.BRAC_UserSpeakControl=function(a,b){this.userId==a&&(a=-1);let c,d;if(-1==a)c=this.mediaId,d=1;else{d=2;let b=this.userIduserInfoMapping[a]||this.userIduserInfoMappingBackup[a]||{};c=b.mediaId||''}let e={cmdcode:'mediacontrol',mediaid:c,mediatype:d,controltype:b,jsonbuf:''};1==b?!this.mediaDeviceStatus[a]&&(this.mediaDeviceStatus[a]=1,this.emit('websocket_send',e)):0==b&&this.mediaDeviceStatus[a]&&(this.emit('websocket_send',e),this.mediaDeviceStatus[a]=0);let f={cmdcode:'userspeakcontrol',mediaid:c,userid:a,open:b};return this.emit('websocket_send',f),0},AnyChatMiniProgram.prototype.BRAC_UserSpeakControlEx=function(a,b,c,d,e){this.userId==a&&(a=-1);let f,g;if(-1==a)f=this.mediaId,g=1;else{g=2;let b=this.userIduserInfoMapping[a]||this.userIduserInfoMappingBackup[a]||{};f=b.mediaId||''}let h={cmdcode:'mediacontrol',mediaid:f,mediatype:g,controltype:b,jsonbuf:''};1==b?!this.mediaDeviceStatus[a]&&(this.mediaDeviceStatus[a]=1,this.emit('websocket_send',h)):0==b&&this.mediaDeviceStatus[a]&&(this.emit('websocket_send',h),this.mediaDeviceStatus[a]=0);let i={cmdcode:'userspeakcontrolex',mediaid:f,userid:a,open:b,streamindex:c,flags:d,strparam:e};return this.emit('websocket_send',i),0},AnyChatMiniProgram.prototype.BRAC_StreamRecordCtrl=function(){},AnyChatMiniProgram.prototype.BRAC_StreamRecordCtrlEx=function(){},AnyChatMiniProgram.prototype.BRAC_SnapShot=function(){},AnyChatMiniProgram.prototype.BRAC_TransBuffer=function(a,b){return this.emit('websocket_send',{cmdcode:'transbuffer',userid:a,jsonbuf:b}),0},AnyChatMiniProgram.prototype.BRAC_TransBufferEx=function(){},AnyChatMiniProgram.prototype.BRAC_TransFile=function(){},AnyChatMiniProgram.prototype.BRAC_QueryTransTaskInfo=function(){},AnyChatMiniProgram.prototype.BRAC_CancelTransTask=function(){},AnyChatMiniProgram.prototype.BRAC_SendTextMessage=function(){},AnyChatMiniProgram.prototype.BRAC_SetSDKOption=function(a,b){let c=Object.prototype.toString.call(b),d='';'[object String]'==c?d='setsdkoptionstring':'[object Number]'==c&&(d='setsdkoptionint');let e={cmdcode:d,optname:a,optval:b};return this.emit('websocket_send',e),0},AnyChatMiniProgram.prototype.BRAC_SDKControl=function(a,b){return this.emit('websocket_send',{cmdcode:'sdkcontrol',ctrlcode:a,param:b}),0},AnyChatMiniProgram.prototype.BRAC_GetSDKOptionInt=function(){},AnyChatMiniProgram.prototype.BRAC_GetSDKOptionString=function(){},AnyChatMiniProgram.prototype.BRAC_GetSDKOptionStringEx=function(){},AnyChatMiniProgram.prototype.BRAC_VideoCallControl=function(a,b,c,d,e,f){return this.emit('websocket_send',{cmdcode:'videocallcontrol',eventtype:a,userid:b,errorcode:c,flags:d,param:e,userstr:f}),0},AnyChatMiniProgram.prototype.BRAC_GetUserInfo=function(){},AnyChatMiniProgram.prototype.BRAC_UserInfoControl=function(){},AnyChatMiniProgram.prototype.BRAC_ObjectGetIntValue=function(a,b,c){let d;return a==anychatdefine.ANYCHAT_OBJECT_TYPE_AREA&&(c==anychatdefine.ANYCHAT_AREA_INFO_AGENTCOUNT&&(d=this.realtimeAreaStatus[b].agentcount),c==anychatdefine.ANYCHAT_AREA_INFO_GUESTCOUNT&&(d=this.realtimeAreaStatus[b].guestcount),c==anychatdefine.ANYCHAT_AREA_INFO_QUEUEUSERCOUNT&&(d=this.realtimeAreaStatus[b].queueusercount),c==anychatdefine.ANYCHAT_AREA_INFO_QUEUECOUNT&&(d=this.realtimeAreaStatus[b].queuecount)),a==anychatdefine.ANYCHAT_OBJECT_TYPE_QUEUE&&(c==anychatdefine.ANYCHAT_QUEUE_INFO_MYSEQUENCENO&&(d=this.realtimeQueueStatus[b].mysequenceno),c==anychatdefine.ANYCHAT_QUEUE_INFO_BEFOREUSERNUM&&(d=this.realtimeQueueStatus[b].beforeusernum),c==anychatdefine.ANYCHAT_QUEUE_INFO_MYENTERQUEUETIME&&(d=this.realtimeQueueStatus[b].myenterqueuetime),c==anychatdefine.ANYCHAT_QUEUE_INFO_LENGTH&&(d=this.realtimeQueueStatus[b].queuelength),c==anychatdefine.ANYCHAT_QUEUE_INFO_WAITTIMESECOND&&(d=this.realtimeQueueStatus[b].waittimesecond)),a==anychatdefine.ANYCHAT_OBJECT_TYPE_AGENT&&(c==anychatdefine.ANYCHAT_AGENT_INFO_SERVICESTATUS&&(d=this.realtimeAgentStatus[b].servicestatus),c==anychatdefine.ANYCHAT_AGENT_INFO_SERVICEUSERID&&(d=this.realtimeAgentStatus[b].serviceuserid),c==anychatdefine.ANYCHAT_AGENT_INFO_SERVICEBEGINTIME&&(d=this.realtimeAgentStatus[b].servicebegintime),c==anychatdefine.ANYCHAT_AGENT_INFO_SERVICETOTALTIME&&(d=this.realtimeAgentStatus[b].servicetotaltime),c==anychatdefine.ANYCHAT_AGENT_INFO_SERVICETOTALNUM&&(d=this.realtimeAgentStatus[b].servicetotalnum)),d},AnyChatMiniProgram.prototype.BRAC_ObjectGetStringValue=function(a,b,c){let d;return a==anychatdefine.ANYCHAT_OBJECT_TYPE_AREA&&(c==anychatdefine.ANYCHAT_OBJECT_INFO_NAME&&(d=this.areaIdareaInfoMapping[b].objectname),c==anychatdefine.ANYCHAT_OBJECT_INFO_FLAGS&&(d=this.areaIdareaInfoMapping[b].flags),c==anychatdefine.ANYCHAT_OBJECT_INFO_PRIORITY&&(d=this.areaIdareaInfoMapping[b].priority),c==anychatdefine.ANYCHAT_OBJECT_INFO_ATTRIBUTE&&(d=this.areaIdareaInfoMapping[b].attribute),c==anychatdefine.ANYCHAT_OBJECT_INFO_DESCRIPTION&&(d=this.areaIdareaInfoMapping[b].description),c==anychatdefine.ANYCHAT_OBJECT_INFO_INTTAG&&(d=this.areaIdareaInfoMapping[b].inttag),c==anychatdefine.ANYCHAT_OBJECT_INFO_STRINGTAG&&(d=this.areaIdareaInfoMapping[b].stringtag)),a==anychatdefine.ANYCHAT_OBJECT_TYPE_QUEUE&&(c==anychatdefine.ANYCHAT_OBJECT_INFO_NAME&&(d=this.queueIdqueueInfoMapping[b].objectname),c==anychatdefine.ANYCHAT_OBJECT_INFO_FLAGS&&(d=this.queueIdqueueInfoMapping[b].flags),c==anychatdefine.ANYCHAT_OBJECT_INFO_PRIORITY&&(d=this.queueIdqueueInfoMapping[b].priority),c==anychatdefine.ANYCHAT_OBJECT_INFO_ATTRIBUTE&&(d=this.queueIdqueueInfoMapping[b].attribute),c==anychatdefine.ANYCHAT_OBJECT_INFO_DESCRIPTION&&(d=this.queueIdqueueInfoMapping[b].description),c==anychatdefine.ANYCHAT_OBJECT_INFO_INTTAG&&(d=this.queueIdqueueInfoMapping[b].inttag),c==anychatdefine.ANYCHAT_OBJECT_INFO_STRINGTAG&&(d=this.queueIdqueueInfoMapping[b].stringtag)),a==anychatdefine.ANYCHAT_OBJECT_TYPE_AGENT&&(c==anychatdefine.ANYCHAT_OBJECT_INFO_NAME&&(d=this.agentIdagentInfoMapping[b].objectname),c==anychatdefine.ANYCHAT_OBJECT_INFO_FLAGS&&(d=this.agentIdagentInfoMapping[b].flags),c==anychatdefine.ANYCHAT_OBJECT_INFO_PRIORITY&&(d=this.agentIdagentInfoMapping[b].priority),c==anychatdefine.ANYCHAT_OBJECT_INFO_ATTRIBUTE&&(d=this.agentIdagentInfoMapping[b].attribute),c==anychatdefine.ANYCHAT_OBJECT_INFO_DESCRIPTION&&(d=this.agentIdagentInfoMapping[b].description),c==anychatdefine.ANYCHAT_OBJECT_INFO_INTTAG&&(d=this.agentIdagentInfoMapping[b].inttag),c==anychatdefine.ANYCHAT_OBJECT_INFO_STRINGTAG&&(d=this.agentIdagentInfoMapping[b].stringtag)),d},AnyChatMiniProgram.prototype.BRAC_ObjectSetValue=function(a,b,c,d){let e=0;'[object String]'==Object.prototype.toString.call(d)&&(e=1);let f={cmdcode:'objectsetvalue',objecttype:a,objectid:b,infoname:c,valuetype:e,infovalue:d};return this.emit('websocket_send',f),0},AnyChatMiniProgram.prototype.BRAC_ObjectControl=function(a,b,c,d,e,f,g,h){return this.emit('websocket_send',{cmdcode:'objectcontrol',objecttype:a,objectid:b,ctrlcode:c,param1:d,param2:e,param3:f,param4:g,strparam:h}),0},AnyChatMiniProgram.prototype.BRAC_SetUserStreamInfo=function(){},AnyChatMiniProgram.prototype.BRAC_ObjectGetIdList=function(a){if(a==anychatdefine.ANYCHAT_OBJECT_TYPE_AREA)return Object.keys(this.areaIdareaInfoMapping);return a==anychatdefine.ANYCHAT_OBJECT_TYPE_QUEUE?Object.keys(this.queueIdqueueInfoMapping):a==anychatdefine.ANYCHAT_OBJECT_TYPE_AGENT?Object.keys(this.agentIdagentInfoMapping):0},module.exports=AnyChatMiniProgram;